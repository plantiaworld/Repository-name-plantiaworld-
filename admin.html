<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì í˜ì´ì§€ - PlantiaWorld</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');

        :root {
            --bg: #0f1117;
            --surface: #1a1d27;
            --surface2: #22263a;
            --border: #2e3348;
            --accent: #4f9cff;
            --accent2: #2e8b57;
            --danger: #ef4444;
            --warning: #f59e0b;
            --success: #10b981;
            --text: #e2e8f0;
            --text2: #94a3b8;
            --text3: #64748b;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            display: flex;
        }

        /* ì‚¬ì´ë“œë°” */
        .sidebar {
            width: 240px;
            background: var(--surface);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            z-index: 100;
        }

        .sidebar-logo {
            padding: 24px 20px;
            border-bottom: 1px solid var(--border);
        }

        .sidebar-logo h1 {
            font-size: 18px;
            font-weight: 700;
            color: var(--accent2);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .sidebar-logo span {
            font-size: 11px;
            color: var(--text3);
            display: block;
            margin-top: 2px;
        }

        .admin-badge {
            display: inline-block;
            background: rgba(79,156,255,0.15);
            color: var(--accent);
            border: 1px solid rgba(79,156,255,0.3);
            border-radius: 6px;
            padding: 2px 8px;
            font-size: 10px;
            font-weight: 700;
            margin-top: 6px;
        }

        .nav-section {
            padding: 16px 12px 8px;
            font-size: 10px;
            font-weight: 700;
            color: var(--text3);
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            margin: 2px 8px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            color: var(--text2);
            transition: all 0.2s;
            position: relative;
        }

        .nav-item:hover { background: var(--surface2); color: var(--text); }
        .nav-item.active { background: rgba(79,156,255,0.12); color: var(--accent); }
        .nav-item.active i { color: var(--accent); }

        .nav-item i { width: 18px; text-align: center; font-size: 14px; }

        .nav-badge {
            margin-left: auto;
            background: var(--danger);
            color: white;
            border-radius: 10px;
            padding: 1px 7px;
            font-size: 11px;
            font-weight: 700;
        }

        .sidebar-footer {
            margin-top: auto;
            padding: 16px;
            border-top: 1px solid var(--border);
        }

        .admin-info {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 13px;
        }

        .admin-avatar {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--accent2), #32cd32);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            flex-shrink: 0;
        }

        .admin-name { font-weight: 600; color: var(--text); font-size: 13px; }
        .admin-role { color: var(--text3); font-size: 11px; }

        /* ë©”ì¸ */
        .main {
            margin-left: 240px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .topbar {
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            padding: 0 28px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 50;
        }

        .topbar-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--text);
        }

        .topbar-actions { display: flex; align-items: center; gap: 12px; }

        .topbar-btn {
            background: var(--surface2);
            border: 1px solid var(--border);
            color: var(--text2);
            padding: 7px 14px;
            border-radius: 8px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Noto Sans KR', sans-serif;
        }
        .topbar-btn:hover { border-color: var(--accent); color: var(--accent); }

        .content { padding: 28px; flex: 1; }

        /* ì„¹ì…˜ */
        .section { display: none; }
        .section.active { display: block; }

        /* í†µê³„ ì¹´ë“œ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 28px;
        }

        .stat-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 3px;
        }

        .stat-card.blue::before { background: var(--accent); }
        .stat-card.green::before { background: var(--success); }
        .stat-card.red::before { background: var(--danger); }
        .stat-card.yellow::before { background: var(--warning); }

        .stat-label { font-size: 12px; color: var(--text3); margin-bottom: 8px; }
        .stat-value { font-size: 28px; font-weight: 700; color: var(--text); }
        .stat-icon {
            position: absolute;
            right: 16px;
            top: 16px;
            font-size: 24px;
            opacity: 0.15;
        }
        .stat-sub { font-size: 11px; color: var(--text3); margin-top: 4px; }

        /* í…Œì´ë¸” */
        .table-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 14px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .table-header {
            padding: 18px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .table-header h3 {
            font-size: 15px;
            font-weight: 700;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .table-header h3 i { color: var(--accent); }

        .search-input {
            background: var(--surface2);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 7px 12px;
            border-radius: 8px;
            font-size: 13px;
            width: 200px;
            font-family: 'Noto Sans KR', sans-serif;
        }

        .search-input:focus { outline: none; border-color: var(--accent); }
        .search-input::placeholder { color: var(--text3); }

        table { width: 100%; border-collapse: collapse; }
        th {
            background: var(--surface2);
            padding: 11px 16px;
            text-align: left;
            font-size: 12px;
            font-weight: 600;
            color: var(--text3);
            letter-spacing: 0.5px;
        }

        td {
            padding: 13px 16px;
            font-size: 13px;
            color: var(--text2);
            border-top: 1px solid var(--border);
            vertical-align: middle;
        }

        tr:hover td { background: rgba(255,255,255,0.02); }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
        }

        .badge-red { background: rgba(239,68,68,0.15); color: #f87171; }
        .badge-yellow { background: rgba(245,158,11,0.15); color: #fbbf24; }
        .badge-green { background: rgba(16,185,129,0.15); color: #34d399; }
        .badge-blue { background: rgba(79,156,255,0.15); color: #93c5fd; }
        .badge-gray { background: rgba(100,116,139,0.15); color: #94a3b8; }

        .action-btn {
            background: none;
            border: 1px solid var(--border);
            color: var(--text2);
            padding: 5px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Noto Sans KR', sans-serif;
            margin-right: 4px;
        }

        .action-btn:hover { border-color: var(--accent); color: var(--accent); }
        .action-btn.danger:hover { border-color: var(--danger); color: var(--danger); }
        .action-btn.success:hover { border-color: var(--success); color: var(--success); }

        /* ë¡œë”© */
        .loading-row td {
            text-align: center;
            padding: 40px;
            color: var(--text3);
        }

        /* ëª¨ë‹¬ */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.open { display: flex; }

        .modal {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 18px;
            padding: 28px;
            width: 480px;
            max-width: 90vw;
        }

        .modal h3 { font-size: 17px; font-weight: 700; margin-bottom: 20px; color: var(--text); }

        .modal-field { margin-bottom: 16px; }
        .modal-label { font-size: 12px; color: var(--text3); margin-bottom: 6px; display: block; }
        .modal-value {
            background: var(--surface2);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 10px 14px;
            font-size: 13px;
            color: var(--text);
            line-height: 1.6;
        }

        .modal-actions { display: flex; gap: 10px; margin-top: 20px; }

        .btn {
            flex: 1;
            padding: 10px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            font-family: 'Noto Sans KR', sans-serif;
            transition: all 0.2s;
        }

        .btn-primary { background: var(--accent); color: white; }
        .btn-primary:hover { opacity: 0.9; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-danger:hover { opacity: 0.9; }
        .btn-secondary { background: var(--surface2); color: var(--text2); border: 1px solid var(--border); }
        .btn-secondary:hover { border-color: var(--accent); color: var(--accent); }

        /* ì ‘ê·¼ ê±°ë¶€ í™”ë©´ */
        .access-denied {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            text-align: center;
            background: var(--bg);
        }

        .access-denied i { font-size: 60px; color: var(--danger); margin-bottom: 20px; opacity: 0.6; }
        .access-denied h2 { font-size: 22px; font-weight: 700; margin-bottom: 8px; }
        .access-denied p { color: var(--text3); font-size: 14px; }

        /* í•„í„° íƒ­ */
        .filter-tabs {
            display: flex;
            gap: 6px;
        }

        .filter-tab {
            padding: 5px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            border: 1px solid var(--border);
            color: var(--text3);
            background: none;
            font-family: 'Noto Sans KR', sans-serif;
            transition: all 0.2s;
        }

        .filter-tab.active, .filter-tab:hover {
            background: rgba(79,156,255,0.12);
            border-color: var(--accent);
            color: var(--accent);
        }

        /* í† ìŠ¤íŠ¸ */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-left: 4px solid var(--success);
            border-radius: 12px;
            padding: 14px 20px;
            font-size: 14px;
            color: var(--text);
            z-index: 9999;
            display: none;
            animation: slideIn 0.3s ease;
            box-shadow: 0 8px 30px rgba(0,0,0,0.3);
        }

        @keyframes slideIn {
            from { transform: translateX(20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .empty-state {
            text-align: center;
            padding: 48px 20px;
            color: var(--text3);
        }

        .empty-state i { font-size: 36px; margin-bottom: 12px; display: block; opacity: 0.4; }
        .empty-state p { font-size: 14px; }

        @media (max-width: 900px) {
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .sidebar { width: 60px; }
            .sidebar .nav-item span, .sidebar-logo span,
            .sidebar-logo h1 span:last-child, .nav-section,
            .admin-name, .admin-role, .admin-badge { display: none; }
            .main { margin-left: 60px; }
        }
    </style>
</head>
<body>

<!-- ì ‘ê·¼ ê±°ë¶€ í™”ë©´ (ë¹„ê´€ë¦¬ì) -->
<div id="accessDenied" class="access-denied" style="display:none;">
    <i class="fas fa-shield-alt"></i>
    <h2>ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤</h2>
    <p style="margin-top:8px;">ê´€ë¦¬ì ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•´ ì£¼ì„¸ìš”.</p>
    <button onclick="window.location.href='index.html'" style="margin-top:24px; background:var(--accent); color:white; border:none; padding:10px 24px; border-radius:10px; font-size:14px; cursor:pointer; font-family:'Noto Sans KR',sans-serif;">
        ë©”ì¸ìœ¼ë¡œ
    </button>
</div>

<!-- ê´€ë¦¬ì UI -->
<div id="adminUI" style="display:none; width:100%; display:flex;">

    <!-- ì‚¬ì´ë“œë°” -->
    <aside class="sidebar">
        <div class="sidebar-logo">
            <h1>ğŸŒ¿ <span>PlantiaWorld</span></h1>
            <span>Admin Dashboard</span>
            <div class="admin-badge">ADMIN</div>
        </div>

        <div class="nav-section">ë©”ì¸</div>
        <div class="nav-item active" onclick="showSection('dashboard', this)">
            <i class="fas fa-chart-pie"></i><span>ëŒ€ì‹œë³´ë“œ</span>
        </div>

        <div class="nav-section">ê´€ë¦¬</div>
        <div class="nav-item" onclick="showSection('reports', this)">
            <i class="fas fa-flag"></i><span>ì‹ ê³  ê´€ë¦¬</span>
            <span class="nav-badge" id="reportBadge">0</span>
        </div>
        <div class="nav-item" onclick="showSection('products', this)">
            <i class="fas fa-seedling"></i><span>ìƒí’ˆ ê´€ë¦¬</span>
        </div>
        <div class="nav-item" onclick="showSection('users', this)">
            <i class="fas fa-users"></i><span>ì‚¬ìš©ì ê´€ë¦¬</span>
        </div>
        <div class="nav-item" onclick="showSection('inquiries', this)">
            <i class="fas fa-headset"></i><span>ë¬¸ì˜ ê´€ë¦¬</span>
            <span class="nav-badge" id="inquiryBadge" style="display:none;">0</span>
        </div>

        <div class="sidebar-footer">
            <div class="admin-info">
                <div class="admin-avatar">ğŸ‘‘</div>
                <div>
                    <div class="admin-name" id="adminName">ê´€ë¦¬ì</div>
                    <div class="admin-role">Super Admin</div>
                </div>
            </div>
        </div>
    </aside>

    <!-- ë©”ì¸ -->
    <main class="main">
        <div class="topbar">
            <div class="topbar-title" id="topbarTitle">ëŒ€ì‹œë³´ë“œ</div>
            <div class="topbar-actions">
                <button class="topbar-btn" onclick="refreshAll()">
                    <i class="fas fa-sync-alt"></i> ìƒˆë¡œê³ ì¹¨
                </button>
                <button class="topbar-btn" onclick="window.location.href='index.html'">
                    <i class="fas fa-home"></i> ì‚¬ì´íŠ¸
                </button>
            </div>
        </div>

        <div class="content">

            <!-- ëŒ€ì‹œë³´ë“œ -->
            <div class="section active" id="section-dashboard">
                <div class="stats-grid">
                    <div class="stat-card blue">
                        <div class="stat-label">ì „ì²´ ìƒí’ˆ</div>
                        <div class="stat-value" id="stat-products">-</div>
                        <div class="stat-sub">ë“±ë¡ëœ ìƒí’ˆ ìˆ˜</div>
                        <i class="fas fa-seedling stat-icon"></i>
                    </div>
                    <div class="stat-card green">
                        <div class="stat-label">ì „ì²´ íšŒì›</div>
                        <div class="stat-value" id="stat-users">-</div>
                        <div class="stat-sub">ê°€ì… íšŒì› ìˆ˜</div>
                        <i class="fas fa-users stat-icon"></i>
                    </div>
                    <div class="stat-card red">
                        <div class="stat-label">ë¯¸ì²˜ë¦¬ ì‹ ê³ </div>
                        <div class="stat-value" id="stat-reports">-</div>
                        <div class="stat-sub">ì²˜ë¦¬ ëŒ€ê¸° ì¤‘</div>
                        <i class="fas fa-flag stat-icon"></i>
                    </div>
                    <div class="stat-card yellow">
                        <div class="stat-label">ë¯¸ë‹µë³€ ë¬¸ì˜</div>
                        <div class="stat-value" id="stat-inquiries">-</div>
                        <div class="stat-sub">ë‹µë³€ ëŒ€ê¸° ì¤‘</div>
                        <i class="fas fa-headset stat-icon"></i>
                    </div>
                </div>

                <div class="table-card">
                    <div class="table-header">
                        <h3><i class="fas fa-flag"></i> ìµœê·¼ ì‹ ê³ </h3>
                        <button class="topbar-btn" onclick="showSection('reports', document.querySelector('[onclick*=reports]'))">ì „ì²´ ë³´ê¸°</button>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>ì‹ ê³  ì‚¬ìœ </th>
                                <th>ì‹ ê³ ì</th>
                                <th>ëŒ€ìƒ ìƒí’ˆ</th>
                                <th>ì¼ì‹œ</th>
                                <th>ìƒíƒœ</th>
                            </tr>
                        </thead>
                        <tbody id="recentReportsTable">
                            <tr class="loading-row"><td colspan="5"><i class="fas fa-spinner fa-spin"></i> ë¡œë”© ì¤‘...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- ì‹ ê³  ê´€ë¦¬ -->
            <div class="section" id="section-reports">
                <div class="table-card">
                    <div class="table-header">
                        <h3><i class="fas fa-flag"></i> ì‹ ê³  ëª©ë¡</h3>
                        <div style="display:flex; gap:10px;">
                            <div class="filter-tabs">
                                <button class="filter-tab active" onclick="filterReports('all', this)">ì „ì²´</button>
                                <button class="filter-tab" onclick="filterReports('pending', this)">ë¯¸ì²˜ë¦¬</button>
                                <button class="filter-tab" onclick="filterReports('resolved', this)">ì²˜ë¦¬ì™„ë£Œ</button>
                            </div>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>ì‹ ê³  ì‚¬ìœ </th>
                                <th>ìƒì„¸ ë‚´ìš©</th>
                                <th>ì‹ ê³ ì ID</th>
                                <th>ëŒ€ìƒ ìƒí’ˆ ID</th>
                                <th>ì¼ì‹œ</th>
                                <th>ìƒíƒœ</th>
                                <th>ì²˜ë¦¬</th>
                            </tr>
                        </thead>
                        <tbody id="reportsTable">
                            <tr class="loading-row"><td colspan="7"><i class="fas fa-spinner fa-spin"></i> ë¡œë”© ì¤‘...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- ìƒí’ˆ ê´€ë¦¬ -->
            <div class="section" id="section-products">
                <div class="table-card">
                    <div class="table-header">
                        <h3><i class="fas fa-seedling"></i> ìƒí’ˆ ëª©ë¡</h3>
                        <input type="text" class="search-input" placeholder="ìƒí’ˆëª… ê²€ìƒ‰..." id="productSearch" oninput="filterProducts()">
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>ìƒí’ˆëª…</th>
                                <th>ì¹´í…Œê³ ë¦¬</th>
                                <th>ê°€ê²©</th>
                                <th>íŒë§¤ì</th>
                                <th>ìƒíƒœ</th>
                                <th>ì¡°íšŒìˆ˜</th>
                                <th>ê´€ë¦¬</th>
                            </tr>
                        </thead>
                        <tbody id="productsTable">
                            <tr class="loading-row"><td colspan="7"><i class="fas fa-spinner fa-spin"></i> ë¡œë”© ì¤‘...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- ì‚¬ìš©ì ê´€ë¦¬ -->
            <div class="section" id="section-users">
                <div class="table-card">
                    <div class="table-header">
                        <h3><i class="fas fa-users"></i> ì‚¬ìš©ì ëª©ë¡</h3>
                        <input type="text" class="search-input" placeholder="ì´ë¦„/ì´ë©”ì¼ ê²€ìƒ‰..." id="userSearch" oninput="filterUsers()">
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>ì´ë¦„</th>
                                <th>ì´ë©”ì¼</th>
                                <th>ê°€ì…ì¼</th>
                                <th>ìƒíƒœ</th>
                                <th>ê´€ë¦¬</th>
                            </tr>
                        </thead>
                        <tbody id="usersTable">
                            <tr class="loading-row"><td colspan="5"><i class="fas fa-spinner fa-spin"></i> ë¡œë”© ì¤‘...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- ë¬¸ì˜ ê´€ë¦¬ -->
            <div class="section" id="section-inquiries">
                <div class="table-card">
                    <div class="table-header">
                        <h3><i class="fas fa-headset"></i> ë¬¸ì˜ ëª©ë¡</h3>
                        <div class="filter-tabs">
                            <button class="filter-tab active" onclick="filterInquiries('all', this)">ì „ì²´</button>
                            <button class="filter-tab" onclick="filterInquiries('pending', this)">ë¯¸ë‹µë³€</button>
                            <button class="filter-tab" onclick="filterInquiries('answered', this)">ë‹µë³€ì™„ë£Œ</button>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>ìœ í˜•</th>
                                <th>ì œëª©</th>
                                <th>ì‘ì„±ì</th>
                                <th>ì´ë©”ì¼</th>
                                <th>ì¼ì‹œ</th>
                                <th>ìƒíƒœ</th>
                                <th>ì²˜ë¦¬</th>
                            </tr>
                        </thead>
                        <tbody id="inquiriesTable">
                            <tr class="loading-row"><td colspan="7"><i class="fas fa-spinner fa-spin"></i> ë¡œë”© ì¤‘...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

        </div>
    </main>
</div>

<!-- ì‹ ê³  ìƒì„¸ ëª¨ë‹¬ -->
<div class="modal-overlay" id="reportModal">
    <div class="modal">
        <h3><i class="fas fa-flag" style="color:var(--danger); margin-right:8px;"></i>ì‹ ê³  ìƒì„¸</h3>
        <div class="modal-field">
            <label class="modal-label">ì‹ ê³  ì‚¬ìœ </label>
            <div class="modal-value" id="modal-reason">-</div>
        </div>
        <div class="modal-field">
            <label class="modal-label">ìƒì„¸ ë‚´ìš©</label>
            <div class="modal-value" id="modal-details">-</div>
        </div>
        <div class="modal-field">
            <label class="modal-label">ëŒ€ìƒ ìƒí’ˆ ID</label>
            <div class="modal-value" id="modal-productId">-</div>
        </div>
        <div class="modal-actions">
            <button class="btn btn-secondary" onclick="closeModal('reportModal')">ë‹«ê¸°</button>
            <button class="btn btn-danger" id="modal-delete-btn">ìƒí’ˆ ì‚­ì œ</button>
            <button class="btn btn-primary" id="modal-resolve-btn">ì²˜ë¦¬ì™„ë£Œ</button>
        </div>
    </div>
</div>

<!-- ë¬¸ì˜ ë‹µë³€ ëª¨ë‹¬ -->
<div class="modal-overlay" id="inquiryModal">
    <div class="modal">
        <h3><i class="fas fa-reply" style="color:var(--accent); margin-right:8px;"></i>ë¬¸ì˜ ìƒì„¸ / ë‹µë³€</h3>
        <div class="modal-field">
            <label class="modal-label">ë¬¸ì˜ ìœ í˜•</label>
            <div class="modal-value" id="inq-type">-</div>
        </div>
        <div class="modal-field">
            <label class="modal-label">ì œëª©</label>
            <div class="modal-value" id="inq-title">-</div>
        </div>
        <div class="modal-field">
            <label class="modal-label">ë‚´ìš©</label>
            <div class="modal-value" id="inq-content" style="min-height:80px;">-</div>
        </div>
        <div class="modal-field">
            <label class="modal-label">ë‹µë³€ ë©”ëª¨ (ë‚´ë¶€ìš©)</label>
            <textarea id="inq-answer" rows="3" style="width:100%; background:var(--surface2); border:1px solid var(--border); color:var(--text); border-radius:8px; padding:10px 14px; font-size:13px; resize:vertical; font-family:'Noto Sans KR',sans-serif;" placeholder="ì²˜ë¦¬ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
        </div>
        <div class="modal-actions">
            <button class="btn btn-secondary" onclick="closeModal('inquiryModal')">ë‹«ê¸°</button>
            <button class="btn btn-primary" id="inq-resolve-btn">ë‹µë³€ ì™„ë£Œ ì²˜ë¦¬</button>
        </div>
    </div>
</div>

<!-- í† ìŠ¤íŠ¸ -->
<div class="toast" id="toast"></div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js";
    import {
        getFirestore, collection, getDocs, doc,
        updateDoc, deleteDoc, query, orderBy, limit, where, getDoc, serverTimestamp
    } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAW_z3hoI9SZ1-hoxKVYBKs7rbdo8n6wdc",
        authDomain: "plantiaworld.firebaseapp.com",
        projectId: "plantiaworld",
        storageBucket: "plantiaworld.firebasestorage.app",
        messagingSenderId: "18112813073",
        appId: "1:18112813073:web:7247046c038a3831db79b0"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // âš ï¸ ê´€ë¦¬ì UID ëª©ë¡ - ë³¸ì¸ UIDë¡œ êµì²´í•˜ì„¸ìš”
    const ADMIN_UIDS = [
        'LIuwCkomQmf0iHf7QoBXs57OecI2'
    ];

    let allReports = [], allProducts = [], allUsers = [], allInquiries = [];
    let currentReportFilter = 'all';
    let currentInquiryFilter = 'all';

    function showToast(msg, type = 'success') {
        const t = document.getElementById('toast');
        t.textContent = msg;
        t.style.borderLeftColor = type === 'success' ? 'var(--success)' : type === 'error' ? 'var(--danger)' : 'var(--warning)';
        t.style.display = 'block';
        setTimeout(() => t.style.display = 'none', 2500);
    }

    window.showToast = showToast;

    function formatDate(ts) {
        if (!ts) return '-';
        const d = ts.seconds ? new Date(ts.seconds * 1000) : new Date(ts);
        const now = new Date();
        const diff = Math.floor((now - d) / 1000);
        if (diff < 60) return 'ë°©ê¸ˆ ì „';
        if (diff < 3600) return `${Math.floor(diff/60)}ë¶„ ì „`;
        if (diff < 86400) return `${Math.floor(diff/3600)}ì‹œê°„ ì „`;
        return `${Math.floor(diff/86400)}ì¼ ì „`;
    }

    // ===== ì¸ì¦ í™•ì¸ =====
    onAuthStateChanged(auth, async (user) => {
        if (user && ADMIN_UIDS.includes(user.uid)) {
            document.getElementById('accessDenied').style.display = 'none';
            document.getElementById('adminUI').style.display = 'flex';
            document.getElementById('adminName').textContent = user.displayName || user.email?.split('@')[0] || 'ê´€ë¦¬ì';
            await loadAll();
        } else {
            document.getElementById('adminUI').style.display = 'none';
            document.getElementById('accessDenied').style.display = 'flex';
        }
    });

    // ===== ì „ì²´ ë¡œë“œ =====
    async function loadAll() {
        await Promise.all([loadReports(), loadProducts(), loadUsers(), loadInquiries()]);
        updateStats();
    }
    window.refreshAll = loadAll;

    // ===== í†µê³„ ì—…ë°ì´íŠ¸ =====
    function updateStats() {
        document.getElementById('stat-products').textContent = allProducts.length;
        document.getElementById('stat-users').textContent = allUsers.length;
        const pendingReports = allReports.filter(r => r.status !== 'resolved').length;
        const pendingInquiries = allInquiries.filter(i => i.status !== 'answered').length;
        document.getElementById('stat-reports').textContent = pendingReports;
        document.getElementById('stat-inquiries').textContent = pendingInquiries;
        document.getElementById('reportBadge').textContent = pendingReports;
        document.getElementById('reportBadge').style.display = pendingReports > 0 ? '' : 'none';
        if (pendingInquiries > 0) {
            document.getElementById('inquiryBadge').textContent = pendingInquiries;
            document.getElementById('inquiryBadge').style.display = '';
        }
    }

    // ===== ì‹ ê³  ë¡œë“œ =====
    async function loadReports() {
        try {
            const snap = await getDocs(query(collection(db, 'reports'), orderBy('createdAt', 'desc')));
            allReports = snap.docs.map(d => ({ id: d.id, ...d.data() }));
            renderReports(allReports);
            renderRecentReports(allReports.slice(0, 5));
        } catch (e) {
            document.getElementById('reportsTable').innerHTML = `<tr class="loading-row"><td colspan="7">âš ï¸ ì‹ ê³  ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</td></tr>`;
        }
    }

    function renderRecentReports(reports) {
        const tbody = document.getElementById('recentReportsTable');
        if (!reports.length) {
            tbody.innerHTML = `<tr><td colspan="5" style="text-align:center; padding:30px; color:var(--text3);">ì‹ ê³ ê°€ ì—†ìŠµë‹ˆë‹¤</td></tr>`;
            return;
        }
        tbody.innerHTML = reports.map(r => `
            <tr>
                <td><span class="badge badge-red"><i class="fas fa-flag"></i> ${r.reason || '-'}</span></td>
                <td style="color:var(--text3); font-size:12px;">${(r.reporterId || '-').substring(0, 12)}...</td>
                <td style="font-size:12px; color:var(--text3);">${(r.productId || '-').substring(0, 12)}...</td>
                <td style="font-size:12px;">${formatDate(r.createdAt)}</td>
                <td>${r.status === 'resolved'
                    ? '<span class="badge badge-green">ì²˜ë¦¬ì™„ë£Œ</span>'
                    : '<span class="badge badge-red">ë¯¸ì²˜ë¦¬</span>'}</td>
            </tr>
        `).join('');
    }

    function renderReports(reports) {
        const tbody = document.getElementById('reportsTable');
        const filtered = currentReportFilter === 'all' ? reports
            : currentReportFilter === 'pending' ? reports.filter(r => r.status !== 'resolved')
            : reports.filter(r => r.status === 'resolved');

        if (!filtered.length) {
            tbody.innerHTML = `<tr><td colspan="7"><div class="empty-state"><i class="fas fa-flag"></i><p>ì‹ ê³  ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</p></div></td></tr>`;
            return;
        }

        tbody.innerHTML = filtered.map(r => `
            <tr>
                <td><span class="badge badge-red">${r.reason || '-'}</span></td>
                <td style="max-width:160px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; font-size:12px; color:var(--text3);">${r.details || '-'}</td>
                <td style="font-size:11px; color:var(--text3);">${(r.reporterId || '-').substring(0, 10)}...</td>
                <td style="font-size:11px; color:var(--text3);">${(r.productId || '-').substring(0, 10)}...</td>
                <td style="font-size:12px;">${formatDate(r.createdAt)}</td>
                <td>${r.status === 'resolved'
                    ? '<span class="badge badge-green">ì²˜ë¦¬ì™„ë£Œ</span>'
                    : '<span class="badge badge-yellow">ë¯¸ì²˜ë¦¬</span>'}</td>
                <td>
                    <button class="action-btn" onclick="openReportModal('${r.id}')">ìƒì„¸</button>
                    ${r.status !== 'resolved' ? `<button class="action-btn success" onclick="resolveReport('${r.id}')">ì™„ë£Œ</button>` : ''}
                </td>
            </tr>
        `).join('');
    }

    window.filterReports = function(type, el) {
        currentReportFilter = type;
        document.querySelectorAll('#section-reports .filter-tab').forEach(t => t.classList.remove('active'));
        el.classList.add('active');
        renderReports(allReports);
    };

    window.openReportModal = function(id) {
        const r = allReports.find(r => r.id === id);
        if (!r) return;
        // âœ… FIX: null ì²´í¬ ì¶”ê°€ - DOM ìš”ì†Œ ì•ˆì „ ì ‘ê·¼
        const setEl = (elId, val) => { const el = document.getElementById(elId); if (el) el.textContent = val; };
        setEl('modal-reason', r.reason || '-');
        setEl('modal-details', r.details || '-');
        setEl('modal-productId', r.productId || '-');
        const resolveBtn = document.getElementById('modal-resolve-btn');
        const deleteBtn  = document.getElementById('modal-delete-btn');
        if (resolveBtn) resolveBtn.onclick = () => resolveReport(id);
        if (deleteBtn)  deleteBtn.onclick  = () => deleteReportedProduct(r.productId, id);
        const modal = document.getElementById('reportModal');
        if (modal) modal.classList.add('open');
    };

    window.resolveReport = async function(id) {
        try {
            await updateDoc(doc(db, 'reports', id), { status: 'resolved', resolvedAt: serverTimestamp() });
            showToast('ì‹ ê³ ê°€ ì²˜ë¦¬ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤');
            closeModal('reportModal');
            await loadReports();
            updateStats();
        } catch (e) {
            showToast('ì²˜ë¦¬ ì‹¤íŒ¨', 'error');
        }
    };

    window.deleteReportedProduct = async function(productId, reportId) {
        if (!productId) { showToast('ìƒí’ˆ IDê°€ ì—†ìŠµë‹ˆë‹¤', 'error'); return; }
        if (!confirm('í•´ë‹¹ ìƒí’ˆì„ ì‚­ì œí•˜ê³  ì‹ ê³ ë¥¼ ì²˜ë¦¬ ì™„ë£Œë¡œ ë³€ê²½í• ê¹Œìš”?')) return;
        try {
            await deleteDoc(doc(db, 'products', productId));
            await updateDoc(doc(db, 'reports', reportId), { status: 'resolved', resolvedAt: serverTimestamp() });
            showToast('ìƒí’ˆì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
            closeModal('reportModal');
            await Promise.all([loadReports(), loadProducts()]);
            updateStats();
        } catch (e) {
            showToast('ì‚­ì œ ì‹¤íŒ¨', 'error');
        }
    };

    // ===== ìƒí’ˆ ë¡œë“œ =====
    async function loadProducts() {
        try {
            const snap = await getDocs(query(collection(db, 'products'), orderBy('createdAt', 'desc')));
            allProducts = snap.docs.map(d => ({ id: d.id, ...d.data() }));
            renderProducts(allProducts);
        } catch (e) {
            document.getElementById('productsTable').innerHTML = `<tr class="loading-row"><td colspan="7">âš ï¸ ìƒí’ˆ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</td></tr>`;
        }
    }

    function renderProducts(products) {
        const tbody = document.getElementById('productsTable');
        if (!products.length) {
            tbody.innerHTML = `<tr><td colspan="7"><div class="empty-state"><i class="fas fa-seedling"></i><p>ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤</p></div></td></tr>`;
            return;
        }
        tbody.innerHTML = products.map(p => {
            const statusBadge = p.status === 'íŒë§¤ì¤‘' ? 'badge-blue' : p.status === 'ì˜ˆì•½ì¤‘' ? 'badge-yellow' : 'badge-gray';
            return `
            <tr>
                <td style="font-weight:600; color:var(--text);">${p.title || '-'}</td>
                <td><span class="badge badge-green">${p.category || '-'}</span></td>
                <td style="color:var(--accent);">${p.price ? p.price.toLocaleString() + 'ì›' : 'ë¬´ë£Œ'}</td>
                <td style="font-size:12px; color:var(--text3);">${(p.sellerName || p.sellerId || '-').substring(0, 12)}</td>
                <td><span class="badge ${statusBadge}">${p.status || '-'}</span></td>
                <td style="color:var(--text3);">${p.views || 0}</td>
                <td>
                    <button class="action-btn" onclick="window.open('product-detail.html?id=${p.id}', '_blank')">ë³´ê¸°</button>
                    <button class="action-btn danger" onclick="deleteProduct('${p.id}')">ì‚­ì œ</button>
                </td>
            </tr>
            `;
        }).join('');
    }

    window.filterProducts = function() {
        const q = document.getElementById('productSearch').value.toLowerCase();
        renderProducts(allProducts.filter(p => (p.title || '').toLowerCase().includes(q)));
    };

    window.deleteProduct = async function(id) {
        if (!confirm('ì´ ìƒí’ˆì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
        try {
            await deleteDoc(doc(db, 'products', id));
            showToast('ìƒí’ˆì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
            await loadProducts();
            updateStats();
        } catch (e) {
            showToast('ì‚­ì œ ì‹¤íŒ¨', 'error');
        }
    };

    // ===== ì‚¬ìš©ì ë¡œë“œ =====
    async function loadUsers() {
        try {
            const snap = await getDocs(collection(db, 'users'));
            allUsers = snap.docs.map(d => ({ id: d.id, ...d.data() }));
            renderUsers(allUsers);
        } catch (e) {
            document.getElementById('usersTable').innerHTML = `<tr class="loading-row"><td colspan="5">âš ï¸ ì‚¬ìš©ì ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</td></tr>`;
        }
    }

    function renderUsers(users) {
        const tbody = document.getElementById('usersTable');
        if (!users.length) {
            tbody.innerHTML = `<tr><td colspan="5"><div class="empty-state"><i class="fas fa-users"></i><p>ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤</p></div></td></tr>`;
            return;
        }
        tbody.innerHTML = users.map(u => `
            <tr>
                <td style="font-weight:600; color:var(--text);">${u.displayName || u.name || '-'}</td>
                <td style="color:var(--text3); font-size:12px;">${u.email || '-'}</td>
                <td style="font-size:12px;">${formatDate(u.createdAt)}</td>
                <td><span class="badge ${u.banned ? 'badge-red' : 'badge-green'}">${u.banned ? 'ì •ì§€' : 'ì •ìƒ'}</span></td>
                <td>
                    <button class="action-btn ${u.banned ? 'success' : 'danger'}" onclick="toggleBanUser('${u.id}', ${!!u.banned})">
                        ${u.banned ? 'ì •ì§€ í•´ì œ' : 'ì´ìš© ì •ì§€'}
                    </button>
                </td>
            </tr>
        `).join('');
    }

    window.filterUsers = function() {
        const q = document.getElementById('userSearch').value.toLowerCase();
        renderUsers(allUsers.filter(u =>
            (u.displayName || '').toLowerCase().includes(q) ||
            (u.email || '').toLowerCase().includes(q)
        ));
    };

    window.toggleBanUser = async function(id, isBanned) {
        const msg = isBanned ? 'ì´ ì‚¬ìš©ìì˜ ì •ì§€ë¥¼ í•´ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?' : 'ì´ ì‚¬ìš©ìë¥¼ ì´ìš© ì •ì§€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?';
        if (!confirm(msg)) return;
        try {
            await updateDoc(doc(db, 'users', id), { banned: !isBanned });
            showToast(isBanned ? 'ì •ì§€ê°€ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤' : 'ì´ìš© ì •ì§€ë˜ì—ˆìŠµë‹ˆë‹¤');
            await loadUsers();
        } catch (e) {
            showToast('ì²˜ë¦¬ ì‹¤íŒ¨', 'error');
        }
    };

    // ===== ë¬¸ì˜ ë¡œë“œ =====
    async function loadInquiries() {
        try {
            const snap = await getDocs(query(collection(db, 'inquiries'), orderBy('createdAt', 'desc')));
            allInquiries = snap.docs.map(d => ({ id: d.id, ...d.data() }));
            renderInquiries(allInquiries);
        } catch (e) {
            document.getElementById('inquiriesTable').innerHTML = `<tr class="loading-row"><td colspan="7">ë¬¸ì˜ ë°ì´í„°ê°€ ì—†ê±°ë‚˜ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</td></tr>`;
        }
    }

    function renderInquiries(inquiries) {
        const tbody = document.getElementById('inquiriesTable');
        const filtered = currentInquiryFilter === 'all' ? inquiries
            : currentInquiryFilter === 'pending' ? inquiries.filter(i => i.status !== 'answered')
            : inquiries.filter(i => i.status === 'answered');

        if (!filtered.length) {
            tbody.innerHTML = `<tr><td colspan="7"><div class="empty-state"><i class="fas fa-headset"></i><p>ë¬¸ì˜ê°€ ì—†ìŠµë‹ˆë‹¤</p></div></td></tr>`;
            return;
        }

        tbody.innerHTML = filtered.map(i => `
            <tr>
                <td><span class="badge badge-blue">${i.type || 'ì¼ë°˜'}</span></td>
                <td style="font-weight:600; color:var(--text);">${i.title || '-'}</td>
                <td>${i.name || '-'}</td>
                <td style="font-size:12px; color:var(--text3);">${i.email || '-'}</td>
                <td style="font-size:12px;">${formatDate(i.createdAt)}</td>
                <td>${i.status === 'answered'
                    ? '<span class="badge badge-green">ë‹µë³€ì™„ë£Œ</span>'
                    : '<span class="badge badge-yellow">ë¯¸ë‹µë³€</span>'}</td>
                <td>
                    <button class="action-btn" onclick="openInquiryModal('${i.id}')">ìƒì„¸/ë‹µë³€</button>
                </td>
            </tr>
        `).join('');
    }

    window.filterInquiries = function(type, el) {
        currentInquiryFilter = type;
        document.querySelectorAll('#section-inquiries .filter-tab').forEach(t => t.classList.remove('active'));
        el.classList.add('active');
        renderInquiries(allInquiries);
    };

    window.openInquiryModal = function(id) {
        const i = allInquiries.find(i => i.id === id);
        if (!i) return;
        // âœ… FIX: null ì²´í¬ ì¶”ê°€ - DOM ìš”ì†Œ ì•ˆì „ ì ‘ê·¼
        const setEl = (elId, val, prop='textContent') => {
            const el = document.getElementById(elId);
            if (el) el[prop] = val;
        };
        setEl('inq-type', i.type || '-');
        setEl('inq-title', i.title || '-');
        setEl('inq-content', i.content || '-');
        setEl('inq-answer', i.adminNote || '', 'value');
        const resolveBtn = document.getElementById('inq-resolve-btn');
        if (resolveBtn) {
            resolveBtn.onclick = async () => {
                try {
                    const answerEl = document.getElementById('inq-answer');
                    await updateDoc(doc(db, 'inquiries', id), {
                        status: 'answered',
                        adminNote: answerEl ? answerEl.value : '',
                        answeredAt: serverTimestamp()
                    });
                    showToast('ë‹µë³€ ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤');
                    closeModal('inquiryModal');
                    await loadInquiries();
                    updateStats();
                } catch(e) { showToast('ì²˜ë¦¬ ì‹¤íŒ¨', 'error'); }
            };
        }
        const modal = document.getElementById('inquiryModal');
        if (modal) modal.classList.add('open');
    };

    // ===== ê³µí†µ =====
    window.showSection = function(name, el) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById('section-' + name).classList.add('active');
        if (el) el.classList.add('active');
        const titles = { dashboard:'ëŒ€ì‹œë³´ë“œ', reports:'ì‹ ê³  ê´€ë¦¬', products:'ìƒí’ˆ ê´€ë¦¬', users:'ì‚¬ìš©ì ê´€ë¦¬', inquiries:'ë¬¸ì˜ ê´€ë¦¬' };
        document.getElementById('topbarTitle').textContent = titles[name] || '';
    };

    window.closeModal = function(id) {
        document.getElementById(id).classList.remove('open');
    };
</script>

</body>
</html>
