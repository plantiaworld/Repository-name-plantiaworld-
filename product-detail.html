<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹ë¬¼ ìƒì„¸ ì •ë³´ - PlantiaWorld</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
        import { 
            getAuth, 
            onAuthStateChanged 
        } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js";
        import { 
            getFirestore, 
            doc, 
            getDoc, 
            setDoc,
            updateDoc,
            deleteDoc,
            increment,
            arrayUnion,
            arrayRemove,
            onSnapshot,
            collection,
            query,
            where,
            getDocs,
            limit,
            addDoc,
            serverTimestamp
        } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

        const firebaseConfig = {
           apiKey: "AIzaSyAW_z3hoI9SZ1-hoxKVYBKs7rbdo8n6wdc",
           authDomain: "plantiaworld.firebaseapp.com",
           projectId: "plantiaworld",
           storageBucket: "plantiaworld.firebasestorage.app",
           messagingSenderId: "18112813073",
           appId: "1:18112813073:web:7247046c038a3831db79b0",
           measurementId: "G-8XSSM279KY"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // ========== ì „ì—­ ë³€ìˆ˜ ==========
        let currentUser = null;
        let currentProduct = null;
        let productId = null;
        let currentSlideIndex = 0;
        let map = null;
        let mapMarker = null;
        let isDataLoaded = false;
        let unsubscribeProduct = null;

        window.firebaseModules = { db, auth };

        // ========== URLì—ì„œ ìƒí’ˆ ID ê°€ì ¸ì˜¤ê¸° ==========
        const urlParams = new URLSearchParams(window.location.search);
        productId = urlParams.get('id');

        if (!productId) {
            alert('ìƒí’ˆ IDê°€ ì—†ìŠµë‹ˆë‹¤.');
            window.location.href = 'index.html';
            throw new Error('No product ID');
        }

        console.log('ğŸ” ìƒí’ˆ ID:', productId);

        // ========== ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ==========
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function formatDate(timestamp) {
            if (!timestamp) return 'ë°©ê¸ˆ ì „';
            try {
                const date = timestamp.seconds ? new Date(timestamp.seconds * 1000) : new Date(timestamp);
                const now = new Date();
                const diff = Math.floor((now - date) / 1000);
                
                if (diff < 60) return 'ë°©ê¸ˆ ì „';
                if (diff < 3600) return `${Math.floor(diff / 60)}ë¶„ ì „`;
                if (diff < 86400) return `${Math.floor(diff / 3600)}ì‹œê°„ ì „`;
                if (diff < 604800) return `${Math.floor(diff / 86400)}ì¼ ì „`;
                return date.toLocaleDateString('ko-KR');
            } catch (error) {
                console.error('ë‚ ì§œ í¬ë§· ì˜¤ë¥˜:', error);
                return 'ì•Œ ìˆ˜ ì—†ìŒ';
            }
        }

        function showToast(message, type = 'success') {
            const existingToast = document.querySelector('.toast');
            if (existingToast) existingToast.remove();
            
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'} mr-2"></i>
                ${escapeHtml(message)}
            `;
            document.body.appendChild(toast);
            
            setTimeout(() => toast.remove(), 3000);
        }

        // ========== ì¸ì¦ ìƒíƒœ í™•ì¸ ==========
        onAuthStateChanged(auth, async (user) => {
            currentUser = user;
            
            if (user) {
                console.log('âœ… ë¡œê·¸ì¸ëœ ì‚¬ìš©ì:', user.uid);
            } else {
                console.log('ğŸ‘¤ ë¹„ë¡œê·¸ì¸ ìƒíƒœ');
            }
            
            if (!isDataLoaded) {
                await loadProductDetail();
                isDataLoaded = true;
            } else {
                if (currentProduct) {
                    updateOwnerActions();
                    updateLikeButton(currentProduct);
                }
            }
        });

        // ========== í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ ë¦¬ìŠ¤ë„ˆ í•´ì œ ==========
        window.addEventListener('beforeunload', () => {
            if (unsubscribeProduct) {
                unsubscribeProduct();
            }
        });

        // ========== ìƒí’ˆ ìƒì„¸ ì •ë³´ ë¡œë“œ ==========
        async function loadProductDetail() {
            try {
                const productRef = doc(db, 'products', productId);
                let hasIncrementedView = false;
                
                console.log('ğŸ“¥ ìƒí’ˆ ë¡œë“œ ì‹œì‘...');
                
                unsubscribeProduct = onSnapshot(productRef, async (snapshot) => {
                    if (snapshot.exists()) {
                        const prevProduct = currentProduct;
                        currentProduct = { id: snapshot.id, ...snapshot.data() };
                        
                        console.log('âœ… ìƒí’ˆ ë°ì´í„°:', currentProduct);
                        
                        // ì¡°íšŒìˆ˜ ì¦ê°€ (ìµœì´ˆ í•œ ë²ˆë§Œ)
                        if (!hasIncrementedView && !sessionStorage.getItem(`viewed_${productId}`)) {
                            hasIncrementedView = true;
                            try {
                                await updateDoc(productRef, { views: increment(1) });
                                sessionStorage.setItem(`viewed_${productId}`, 'true');
                                console.log('ğŸ‘ï¸ ì¡°íšŒìˆ˜ ì¦ê°€ ì™„ë£Œ');
                            } catch (error) {
                                console.error('âŒ ì¡°íšŒìˆ˜ ì¦ê°€ ì˜¤ë¥˜:', error);
                            }
                        }
                        
                        // UI ì—…ë°ì´íŠ¸
                        updateProductUI(currentProduct);
                        
                        // íŒë§¤ì ì •ë³´ ë¡œë“œ
                        if (!prevProduct || prevProduct.sellerId !== currentProduct.sellerId) {
                            if (currentProduct.sellerId) {
                                console.log('ğŸ‘¤ íŒë§¤ì ì •ë³´ ë¡œë“œ ì‹œì‘:', currentProduct.sellerId);
                                await loadSellerInfo(currentProduct.sellerId);
                            } else {
                                console.warn('âš ï¸ ì´ ìƒí’ˆì— sellerIdê°€ ì—†ìŠµë‹ˆë‹¤.');
                                const nameEl = document.getElementById('sellerName');
                                if (nameEl) nameEl.textContent = 'íŒë§¤ì ì •ë³´ ì—†ìŒ';
                            }
                        }
                        
                        // íŒë§¤ìì˜ ë‹¤ë¥¸ ìƒí’ˆ ë¡œë“œ
                        if (!prevProduct || prevProduct.sellerId !== currentProduct.sellerId) {
                            if (currentProduct.sellerId) {
                                await loadSellerOtherProducts(currentProduct.sellerId);
                            }
                        }
                        
                        // ì¶”ì²œ ìƒí’ˆ ë¡œë“œ
                        if (!prevProduct) {
                            await loadSimilarProducts();
                        }
                        
                        // ì†Œìœ ì ê¶Œí•œ UI ì—…ë°ì´íŠ¸
                        updateOwnerActions();
                        
                        // ì¢‹ì•„ìš” ë²„íŠ¼ ì—…ë°ì´íŠ¸
                        updateLikeButton(currentProduct);
                        
                    } else {
                        console.error('âŒ ìƒí’ˆì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                        alert('ìƒí’ˆì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                        window.location.href = 'index.html';
                    }
                });
            } catch (error) {
                console.error('âŒ ìƒí’ˆ ë¡œë“œ ì˜¤ë¥˜:', error);
                alert('ìƒí’ˆ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ========== UI ì—…ë°ì´íŠ¸ ==========
        function updateProductUI(product) {
            console.log('ğŸ¨ UI ì—…ë°ì´íŠ¸ ì‹œì‘');
            
            // ìƒí’ˆëª…
            const titleEl = document.getElementById('productTitle');
            if (titleEl) titleEl.textContent = product.title || 'ì œëª© ì—†ìŒ';
            
            // ê°€ê²©
            const priceEl = document.getElementById('productPrice');
            if (priceEl) priceEl.textContent = product.price ? `${parseInt(product.price).toLocaleString()}ì›` : 'ê°€ê²© ë¯¸ì •';
            
            // ìƒíƒœ
            const statusEl = document.getElementById('productStatus');
            if (statusEl) {
                const statusInfo = {
                    'íŒë§¤ì¤‘': { text: 'íŒë§¤ì¤‘', class: 'bg-blue-100 text-blue-700' },
                    'ì˜ˆì•½ì¤‘': { text: 'ì˜ˆì•½ì¤‘', class: 'bg-orange-100 text-orange-700' },
                    'íŒë§¤ì™„ë£Œ': { text: 'íŒë§¤ì™„ë£Œ', class: 'bg-red-100 text-red-700' }
                };
                const status = statusInfo[product.status] || statusInfo['íŒë§¤ì¤‘'];
                statusEl.innerHTML = `<span class="px-3 py-1 rounded-full text-sm font-bold ${status.class}">${status.text}</span>`;
            }
            
            // ì¹´í…Œê³ ë¦¬
            const categoryEl = document.getElementById('productCategory');
            if (categoryEl) categoryEl.textContent = product.category || 'ê¸°íƒ€';
            
            // ë‚ ì§œ
            const dateEl = document.getElementById('productDate');
            if (dateEl) dateEl.textContent = formatDate(product.createdAt);
            
            // ìœ„ì¹˜
            const locationEl = document.getElementById('productLocation');
            if (locationEl) locationEl.textContent = product.location || 'ìœ„ì¹˜ ì •ë³´ ì—†ìŒ';
            
            // ì„¤ëª…
            const descEl = document.getElementById('productDescription');
            if (descEl) {
                descEl.textContent = product.description || 'ì„¤ëª…ì´ ì—†ìŠµë‹ˆë‹¤.';
            }
            
            // í†µê³„
            const viewCountEl = document.getElementById('viewCount');
            const likeCountEl = document.getElementById('likeCount');
            const chatCountEl = document.getElementById('chatCount');
            
            if (viewCountEl) viewCountEl.textContent = product.views || 0;
            if (likeCountEl) likeCountEl.textContent = product.likeCount || 0;
            if (chatCountEl) chatCountEl.textContent = product.chatCount || 0;
            
            // ì´ë¯¸ì§€ ê°¤ëŸ¬ë¦¬
            updateGallery(product.images || []);
            
            // ì§€ë„
            if (product.tradeLocation) {
                updateMap(product.tradeLocation);
            }
            
            console.log('âœ… UI ì—…ë°ì´íŠ¸ ì™„ë£Œ');
        }

        // ========== ì´ë¯¸ì§€ ê°¤ëŸ¬ë¦¬ ì—…ë°ì´íŠ¸ ==========
        function updateGallery(images) {
            const slider = document.getElementById('imageSlider');
            const indicators = document.getElementById('slideIndicators');
            
            if (!slider || !indicators) return;
            
            if (!images || images.length === 0) {
                slider.innerHTML = `
                    <div class="w-full h-full flex items-center justify-center bg-gray-100">
                        <div class="text-center">
                            <i class="fas fa-image text-gray-300 text-6xl mb-4"></i>
                            <p class="text-gray-400">ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                        </div>
                    </div>
                `;
                indicators.innerHTML = '';
                document.getElementById('prevSlide').style.display = 'none';
                document.getElementById('nextSlide').style.display = 'none';
                return;
            }
            
            // ìŠ¬ë¼ì´ë” ì´ë¯¸ì§€
            slider.innerHTML = images.map(url => `
                <img src="${url}" alt="ìƒí’ˆ ì´ë¯¸ì§€" class="w-full h-full object-contain">
            `).join('');
            
            // ì¸ë””ì¼€ì´í„°
            indicators.innerHTML = images.map((_, index) => `
                <div class="indicator ${index === 0 ? 'active' : ''}" onclick="goToSlide(${index})"></div>
            `).join('');
            
            // ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ í‘œì‹œ
            if (images.length > 1) {
                document.getElementById('prevSlide').style.display = 'flex';
                document.getElementById('nextSlide').style.display = 'flex';
            } else {
                document.getElementById('prevSlide').style.display = 'none';
                document.getElementById('nextSlide').style.display = 'none';
            }
            
            currentSlideIndex = 0;
        }

        // ========== ìŠ¬ë¼ì´ë“œ ì´ë™ ==========
        window.goToSlide = function(index) {
            if (!currentProduct || !currentProduct.images) return;
            
            const images = currentProduct.images;
            const slider = document.getElementById('imageSlider');
            const indicators = document.querySelectorAll('.indicator');
            
            currentSlideIndex = index;
            slider.style.transform = `translateX(-${index * 100}%)`;
            
            indicators.forEach((ind, i) => {
                ind.classList.toggle('active', i === index);
            });
        };

        window.nextSlide = function() {
            if (!currentProduct || !currentProduct.images) return;
            const images = currentProduct.images;
            const nextIndex = (currentSlideIndex + 1) % images.length;
            goToSlide(nextIndex);
        };

        window.prevSlide = function() {
            if (!currentProduct || !currentProduct.images) return;
            const images = currentProduct.images;
            const prevIndex = (currentSlideIndex - 1 + images.length) % images.length;
            goToSlide(prevIndex);
        };

        // ========== ì§€ë„ ì—…ë°ì´íŠ¸ ==========
        function updateMap(location) {
            const mapContainer = document.getElementById('mapContainer');
            const mapEl = document.getElementById('tradeMap');
            
            if (!location || !location.lat || !location.lng) {
                if (mapContainer) mapContainer.classList.add('hidden');
                return;
            }
            
            if (mapContainer) mapContainer.classList.remove('hidden');
            
            if (!map) {
                map = L.map('tradeMap').setView([location.lat, location.lng], 15);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: 'Â© OpenStreetMap contributors'
                }).addTo(map);
                
                mapMarker = L.marker([location.lat, location.lng]).addTo(map);
                if (location.address) {
                    mapMarker.bindPopup(location.address).openPopup();
                }
            } else {
                map.setView([location.lat, location.lng], 15);
                if (mapMarker) {
                    mapMarker.setLatLng([location.lat, location.lng]);
                    if (location.address) {
                        mapMarker.bindPopup(location.address).openPopup();
                    }
                }
            }
            
            setTimeout(() => {
                if (map) map.invalidateSize();
            }, 100);
        }

        // ========== íŒë§¤ì ì •ë³´ ë¡œë“œ ==========
        async function loadSellerInfo(sellerId) {
            if (!sellerId || typeof sellerId !== 'string') {
                console.warn('âš ï¸ loadSellerInfo: ìœ íš¨í•˜ì§€ ì•Šì€ sellerId:', sellerId);
                return;
            }
            try {
                const sellerDoc = await getDoc(doc(db, 'users', sellerId));
                
                if (sellerDoc.exists()) {
                    const seller = sellerDoc.data();
                    console.log('âœ… íŒë§¤ì ì •ë³´:', seller);
                    
                    const avatarEl = document.getElementById('sellerAvatar');
                    const nameEl = document.getElementById('sellerName');
                    const joinDateEl = document.getElementById('sellerJoinDate');
                    
                    if (avatarEl) {
                        avatarEl.src = seller.photoURL || "data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2248%22%20height%3D%2248%22%20viewBox%3D%220%200%2048%2048%22%3E%3Ccircle%20cx%3D%2224%22%20cy%3D%2224%22%20r%3D%2224%22%20fill%3D%22%2310b981%22%2F%3E%3Ccircle%20cx%3D%2224%22%20cy%3D%2218%22%20r%3D%229%22%20fill%3D%22white%22%2F%3E%3Cellipse%20cx%3D%2224%22%20cy%3D%2242%22%20rx%3D%2214%22%20ry%3D%229%22%20fill%3D%22white%22%2F%3E%3C%2Fsvg%3E";
                        avatarEl.onerror = function() {
                            this.src = "data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2248%22%20height%3D%2248%22%20viewBox%3D%220%200%2048%2048%22%3E%3Ccircle%20cx%3D%2224%22%20cy%3D%2224%22%20r%3D%2224%22%20fill%3D%22%2310b981%22%2F%3E%3Ccircle%20cx%3D%2224%22%20cy%3D%2218%22%20r%3D%229%22%20fill%3D%22white%22%2F%3E%3Cellipse%20cx%3D%2224%22%20cy%3D%2242%22%20rx%3D%2214%22%20ry%3D%229%22%20fill%3D%22white%22%2F%3E%3C%2Fsvg%3E";
                        };
                    }
                    if (nameEl) nameEl.textContent = seller.displayName || 'ìµëª…';
                    if (joinDateEl) {
                        const joinDate = seller.createdAt ? new Date(seller.createdAt.seconds * 1000) : new Date();
                        joinDateEl.textContent = joinDate.toLocaleDateString('ko-KR');
                    }
                } else {
                    console.warn('âš ï¸ íŒë§¤ì ì •ë³´ ì—†ìŒ');
                }
            } catch (error) {
                console.error('âŒ íŒë§¤ì ì •ë³´ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        // ========== íŒë§¤ìì˜ ë‹¤ë¥¸ ìƒí’ˆ ë¡œë“œ ==========
        async function loadSellerOtherProducts(sellerId) {
            const container = document.getElementById('sellerOtherProducts');
            if (!container) return;
            
            if (!sellerId || typeof sellerId !== 'string') {
                container.innerHTML = '<p class="col-span-full text-center text-gray-500 py-8">ë‹¤ë¥¸ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤</p>';
                return;
            }
            
            try {
                const q = query(
                    collection(db, 'products'),
                    where('sellerId', '==', sellerId),
                    where('__name__', '!=', productId),
                    limit(4)
                );
                
                const snapshot = await getDocs(q);
                
                if (snapshot.empty) {
                    container.innerHTML = '<p class="col-span-full text-center text-gray-500 py-8">ë‹¤ë¥¸ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤</p>';
                    return;
                }
                
                container.innerHTML = snapshot.docs.map(doc => {
                    const product = doc.data();
                    const firstImage = product.images && product.images[0] 
                        ? product.images[0] 
                        : 'data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%20200%20200%22%3E%3Crect%20width%3D%22200%22%20height%3D%22200%22%20fill%3D%22%23e8f5e9%22%2F%3E%3Ctext%20x%3D%2250%25%22%20y%3D%2250%25%22%20font-size%3D%2260%22%20text-anchor%3D%22middle%22%20dy%3D%22.3em%22%3E%F0%9F%8C%BF%3C%2Ftext%3E%3C%2Fsvg%3E';
                    
                    return `
                        <a href="product-detail.html?id=${doc.id}" class="group block">
                            <div class="glass-card rounded-xl overflow-hidden hover:shadow-lg transition">
                                <div class="aspect-square overflow-hidden bg-gray-100">
                                    <img src="${firstImage}" 
                                         alt="${product.title || 'ìƒí’ˆ'}"
                                         class="w-full h-full object-cover group-hover:scale-105 transition"
                                         onerror="this.src='data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%20200%20200%22%3E%3Crect%20width%3D%22200%22%20height%3D%22200%22%20fill%3D%22%23e8f5e9%22%2F%3E%3Ctext%20x%3D%2250%25%22%20y%3D%2250%25%22%20font-size%3D%2260%22%20text-anchor%3D%22middle%22%20dy%3D%22.3em%22%3E%F0%9F%8C%BF%3C%2Ftext%3E%3C%2Fsvg%3E'">
                                </div>
                                <div class="p-3">
                                    <p class="font-bold text-gray-800 truncate">${product.title || 'ì œëª© ì—†ìŒ'}</p>
                                    <p class="text-green-600 font-bold">${product.price ? parseInt(product.price).toLocaleString() + 'ì›' : 'ê°€ê²© ë¯¸ì •'}</p>
                                    <div class="flex items-center gap-2 text-xs text-gray-500 mt-1">
                                        <span><i class="fas fa-eye"></i> ${product.views || 0}</span>
                                        <span><i class="fas fa-heart"></i> ${product.likeCount || 0}</span>
                                    </div>
                                </div>
                            </div>
                        </a>
                    `;
                }).join('');
                
            } catch (error) {
                console.error('âŒ íŒë§¤ì ë‹¤ë¥¸ ìƒí’ˆ ë¡œë“œ ì˜¤ë¥˜:', error);
                container.innerHTML = '<p class="col-span-full text-center text-gray-500 py-8">ìƒí’ˆì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤</p>';
            }
        }

        // ========== ì¶”ì²œ ìƒí’ˆ ë¡œë“œ ==========
        async function loadSimilarProducts() {
            const container = document.getElementById('similarProducts');
            if (!container) return;
            
            try {
                let q;
                if (currentProduct.category) {
                    q = query(
                        collection(db, 'products'),
                        where('category', '==', currentProduct.category),
                        where('__name__', '!=', productId),
                        limit(4)
                    );
                } else {
                    q = query(
                        collection(db, 'products'),
                        where('__name__', '!=', productId),
                        limit(4)
                    );
                }
                
                const snapshot = await getDocs(q);
                
                if (snapshot.empty) {
                    container.innerHTML = '<p class="col-span-full text-center text-gray-500 py-8">ì¶”ì²œ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤</p>';
                    return;
                }
                
                container.innerHTML = snapshot.docs.map(doc => {
                    const product = doc.data();
                    const firstImage = product.images && product.images[0] 
                        ? product.images[0] 
                        : 'data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%20200%20200%22%3E%3Crect%20width%3D%22200%22%20height%3D%22200%22%20fill%3D%22%23e8f5e9%22%2F%3E%3Ctext%20x%3D%2250%25%22%20y%3D%2250%25%22%20font-size%3D%2260%22%20text-anchor%3D%22middle%22%20dy%3D%22.3em%22%3E%F0%9F%8C%BF%3C%2Ftext%3E%3C%2Fsvg%3E';
                    
                    return `
                        <a href="product-detail.html?id=${doc.id}" class="group block">
                            <div class="glass-card rounded-xl overflow-hidden hover:shadow-lg transition">
                                <div class="aspect-square overflow-hidden bg-gray-100">
                                    <img src="${firstImage}" 
                                         alt="${product.title || 'ìƒí’ˆ'}"
                                         class="w-full h-full object-cover group-hover:scale-105 transition"
                                         onerror="this.src='data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%20200%20200%22%3E%3Crect%20width%3D%22200%22%20height%3D%22200%22%20fill%3D%22%23e8f5e9%22%2F%3E%3Ctext%20x%3D%2250%25%22%20y%3D%2250%25%22%20font-size%3D%2260%22%20text-anchor%3D%22middle%22%20dy%3D%22.3em%22%3E%F0%9F%8C%BF%3C%2Ftext%3E%3C%2Fsvg%3E'">
                                </div>
                                <div class="p-3">
                                    <p class="font-bold text-gray-800 truncate">${product.title || 'ì œëª© ì—†ìŒ'}</p>
                                    <p class="text-green-600 font-bold">${product.price ? parseInt(product.price).toLocaleString() + 'ì›' : 'ê°€ê²© ë¯¸ì •'}</p>
                                    <div class="flex items-center gap-2 text-xs text-gray-500 mt-1">
                                        <span><i class="fas fa-eye"></i> ${product.views || 0}</span>
                                        <span><i class="fas fa-heart"></i> ${product.likeCount || 0}</span>
                                    </div>
                                </div>
                            </div>
                        </a>
                    `;
                }).join('');
                
            } catch (error) {
                console.error('âŒ ì¶”ì²œ ìƒí’ˆ ë¡œë“œ ì˜¤ë¥˜:', error);
                container.innerHTML = '<p class="col-span-full text-center text-gray-500 py-8">ì¶”ì²œ ìƒí’ˆì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤</p>';
            }
        }

        // ========== ì†Œìœ ì ê¶Œí•œ ì—…ë°ì´íŠ¸ ==========
        function updateOwnerActions() {
            const buyerActions = document.getElementById('buyerActions');
            const ownerActions = document.getElementById('ownerActions');
            
            if (currentUser && currentProduct && currentUser.uid === currentProduct.sellerId) {
                if (buyerActions) buyerActions.classList.add('hidden');
                if (ownerActions) ownerActions.classList.remove('hidden');
            } else {
                if (buyerActions) buyerActions.classList.remove('hidden');
                if (ownerActions) ownerActions.classList.add('hidden');
            }
        }

        // ========== ì¢‹ì•„ìš” ë²„íŠ¼ ì—…ë°ì´íŠ¸ ==========
        function updateLikeButton(product) {
            const likeBtn = document.getElementById('likeBtn');
            const likeIcon = document.getElementById('likeIcon');
            
            if (!likeBtn || !likeIcon) return;
            
            const isLiked = currentUser && product.likedBy && product.likedBy.includes(currentUser.uid);
            
            if (isLiked) {
                likeIcon.classList.remove('far');
                likeIcon.classList.add('fas', 'text-red-500');
            } else {
                likeIcon.classList.remove('fas', 'text-red-500');
                likeIcon.classList.add('far', 'text-gray-600');
            }
        }

        // ========== ì¢‹ì•„ìš” í† ê¸€ ==========
        window.toggleLike = async function() {
            if (!currentUser) {
                alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                window.location.href = 'login.html';
                return;
            }
            
            if (!currentProduct) return;
            
            try {
                const productRef = doc(db, 'products', productId);
                const isLiked = currentProduct.likedBy && currentProduct.likedBy.includes(currentUser.uid);
                
                if (isLiked) {
                    await updateDoc(productRef, {
                        likedBy: arrayRemove(currentUser.uid),
                        likeCount: increment(-1)
                    });
                    showToast('ì¢‹ì•„ìš” ì·¨ì†Œ');
                } else {
                    await updateDoc(productRef, {
                        likedBy: arrayUnion(currentUser.uid),
                        likeCount: increment(1)
                    });
                    showToast('ì¢‹ì•„ìš”!');
                }
            } catch (error) {
                console.error('âŒ ì¢‹ì•„ìš” ì˜¤ë¥˜:', error);
                showToast('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
            }
        };

        // ========== ì±„íŒ…í•˜ê¸° ==========
        window.handleChatClick = async function() {
            if (!currentUser) {
                alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                window.location.href = 'login.html';
                return;
            }
            
            if (!currentProduct) return;
            
            if (currentUser.uid === currentProduct.sellerId) {
                alert('ë³¸ì¸ ìƒí’ˆì…ë‹ˆë‹¤.');
                return;
            }
            
            try {
                // ê¸°ì¡´ ì±„íŒ…ë°© í™•ì¸
                const chatsRef = collection(db, 'chats');
                const q = query(
                    chatsRef,
                    where('productId', '==', productId),
                    where('buyerId', '==', currentUser.uid),
                    where('sellerId', '==', currentProduct.sellerId)
                );
                
                const existingChats = await getDocs(q);
                
                if (!existingChats.empty) {
                    const chatId = existingChats.docs[0].id;
                    window.location.href = `chat-room.html?id=${chatId}`;
                } else {
                    // ìƒˆ ì±„íŒ…ë°© ìƒì„±
                    const newChat = await addDoc(collection(db, 'chats'), {
                        productId: productId,
                        productTitle: currentProduct.title,
                        productImage: currentProduct.images && currentProduct.images[0] ? currentProduct.images[0] : null,
                        productPrice: currentProduct.price,
                        sellerId: currentProduct.sellerId,
                        buyerId: currentUser.uid,
                        participants: [currentProduct.sellerId, currentUser.uid],
                        createdAt: serverTimestamp(),
                        lastMessage: '',
                        lastMessageTime: serverTimestamp(),
                        unreadCount: { [currentProduct.sellerId]: 0, [currentUser.uid]: 0 }
                    });
                    
                    // ìƒí’ˆì˜ ì±„íŒ… ìˆ˜ ì¦ê°€
                    await updateDoc(doc(db, 'products', productId), {
                        chatCount: increment(1)
                    });
                    
                    window.location.href = `chat-room.html?id=${newChat.id}`;
                }
            } catch (error) {
                console.error('âŒ ì±„íŒ… ì‹œì‘ ì˜¤ë¥˜:', error);
                alert('ì±„íŒ…ì„ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        };

        // ========== ìƒíƒœ ë³€ê²½ ëª¨ë‹¬ ==========
        window.openStatusModal = function() {
            const modal = document.getElementById('statusModal');
            if (modal) {
                modal.classList.remove('hidden');
                modal.classList.add('flex');
            }
        };

        window.closeStatusModal = function() {
            const modal = document.getElementById('statusModal');
            if (modal) {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
            }
        };

        window.changeStatus = async function(newStatus) {
            if (!currentProduct) return;
            
            try {
                await updateDoc(doc(db, 'products', productId), {
                    status: newStatus
                });
                
                showToast(`ìƒíƒœê°€ "${newStatus}"(ìœ¼)ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤`);
                closeStatusModal();
            } catch (error) {
                console.error('âŒ ìƒíƒœ ë³€ê²½ ì˜¤ë¥˜:', error);
                showToast('ìƒíƒœ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', 'error');
            }
        };

        // ========== ìƒí’ˆ ìˆ˜ì • ==========
        window.editProduct = function() {
            if (!productId) {
                alert('ìƒí’ˆ IDë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            window.location.href = `edit-product.html?id=${productId}`;
        };

        // ========== ìƒí’ˆ ì‚­ì œ ==========
        window.deleteProduct = async function() {
            if (!confirm('ì •ë§ ì´ ìƒí’ˆì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            try {
                // ì‚­ì œ ì „ onSnapshot ë¦¬ìŠ¤ë„ˆ ë¨¼ì € í•´ì œ (ì‚­ì œëœ ë¬¸ì„œ ê°ì§€ ì˜¤ë¥˜ ë°©ì§€)
                if (unsubscribeProduct) {
                    unsubscribeProduct();
                    unsubscribeProduct = null;
                }
                await deleteDoc(doc(db, 'products', productId));
                alert('ìƒí’ˆì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                window.location.href = 'index.html';
            } catch (error) {
                console.error('âŒ ì‚­ì œ ì˜¤ë¥˜:', error);
                alert('ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        };

        // ========== ì‹ ê³  ëª¨ë‹¬ ==========
        window.openReportModal = function() {
            if (!currentUser) {
                alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                return;
            }
            const modal = document.getElementById('reportModal');
            if (modal) {
                modal.classList.remove('hidden');
                modal.classList.add('flex');
            }
        };

        window.closeReportModal = function() {
            const modal = document.getElementById('reportModal');
            if (modal) {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
            }
            document.getElementById('reportReason').value = '';
            document.getElementById('reportDetails').value = '';
        };

        window.submitReport = async function() {
            const reason = document.getElementById('reportReason').value;
            const details = document.getElementById('reportDetails').value;
            
            if (!reason) {
                alert('ì‹ ê³  ì‚¬ìœ ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!details.trim()) {
                alert('ìƒì„¸ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            try {
                await addDoc(collection(db, 'reports'), {
                    type: 'product',
                    productId: productId,
                    reporterId: currentUser.uid,
                    reportedUserId: currentProduct.sellerId,
                    reason: reason,
                    details: details,
                    createdAt: serverTimestamp(),
                    status: 'pending'
                });
                
                showToast('ì‹ ê³ ê°€ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤');
                closeReportModal();
            } catch (error) {
                console.error('âŒ ì‹ ê³  ì˜¤ë¥˜:', error);
                showToast('ì‹ ê³  ì ‘ìˆ˜ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', 'error');
            }
        };

        window.blockUser = async function() {
            if (!confirm('ì´ ì‚¬ìš©ìì˜ ëª¨ë“  ê²Œì‹œê¸€ì„ ë³´ì§€ ì•Šìœ¼ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            try {
                const userRef = doc(db, 'users', currentUser.uid);
                await updateDoc(userRef, {
                    blockedUsers: arrayUnion(currentProduct.sellerId)
                });
                
                showToast('ì‚¬ìš©ìë¥¼ ì°¨ë‹¨í–ˆìŠµë‹ˆë‹¤');
                closeReportModal();
                
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 1500);
            } catch (error) {
                console.error('âŒ ì°¨ë‹¨ ì˜¤ë¥˜:', error);
                showToast('ì°¨ë‹¨ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', 'error');
            }
        };

        // ========== ë’¤ë¡œê°€ê¸° ==========
        window.goBack = function() {
            window.location.href = 'index.html';
        };

    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding-bottom: 100px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        /* í—¤ë” */
        .header {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
            padding: 16px 0;
        }

        /* ì´ë¯¸ì§€ ê°¤ëŸ¬ë¦¬ */
        .image-gallery {
            position: relative;
            width: 100%;
            aspect-ratio: 1;
            overflow: hidden;
            background: #f8f9fa;
            border-radius: 16px;
        }

        .image-slider {
            display: flex;
            transition: transform 0.3s ease;
            height: 100%;
        }

        .image-slider img {
            flex-shrink: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .nav-button {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.9);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            z-index: 10;
        }

        .nav-button:hover {
            background: white;
            transform: translateY(-50%) scale(1.1);
        }

        .nav-button.prev { left: 10px; }
        .nav-button.next { right: 10px; }

        .slide-indicators {
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
            z-index: 10;
        }

        .indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            transition: all 0.3s;
        }

        .indicator.active {
            background: white;
            width: 24px;
            border-radius: 4px;
        }

        /* ì§€ë„ */
        #tradeMap {
            width: 100%;
            height: 300px;
            border-radius: 12px;
            overflow: hidden;
        }

        /* í•˜ë‹¨ ê³ ì • ë°” */
        .floating-bottom {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            padding: 16px;
            z-index: 50;
        }

        /* ëª¨ë‹¬ */
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 200;
            padding: 20px;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        /* í† ìŠ¤íŠ¸ */
        .toast {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: #10b981;
            color: white;
            padding: 12px 24px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 300;
            display: flex;
            align-items: center;
            animation: slideDown 0.3s ease;
        }

        .toast-error {
            background: #ef4444;
        }

        @keyframes slideDown {
            from {
                transform: translateX(-50%) translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .container {
                padding: 12px;
            }

            .nav-button {
                width: 32px;
                height: 32px;
            }
        }
    </style>
</head>
<body>
    
    <!-- í—¤ë” -->
    <header class="header">
        <div class="container mx-auto max-w-4xl flex items-center justify-between">
            <button onclick="goBack()" class="p-2 hover:bg-gray-100 rounded-lg transition">
                <i class="fas fa-arrow-left text-xl text-gray-700"></i>
            </button>
            <h1 class="text-lg font-bold text-gray-800">ìƒí’ˆ ìƒì„¸</h1>
            <button onclick="openReportModal()" class="p-2 hover:bg-gray-100 rounded-lg transition">
                <i class="fas fa-ellipsis-v text-xl text-gray-700"></i>
            </button>
        </div>
    </header>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <div class="container mx-auto max-w-4xl mt-4">
        
        <!-- ì´ë¯¸ì§€ ê°¤ëŸ¬ë¦¬ -->
        <div class="glass-card rounded-2xl overflow-hidden mb-4">
            <div class="image-gallery">
                <div id="imageSlider" class="image-slider">
                    <div class="w-full h-full flex items-center justify-center bg-gray-100">
                        <div class="text-center">
                            <i class="fas fa-spinner fa-spin text-gray-400 text-4xl mb-3"></i>
                            <p class="text-gray-500">ì´ë¯¸ì§€ ë¡œë”© ì¤‘...</p>
                        </div>
                    </div>
                </div>
                
                <button id="prevSlide" onclick="prevSlide()" class="nav-button prev" style="display: none;">
                    <i class="fas fa-chevron-left text-gray-700"></i>
                </button>
                <button id="nextSlide" onclick="nextSlide()" class="nav-button next" style="display: none;">
                    <i class="fas fa-chevron-right text-gray-700"></i>
                </button>
                
                <div id="slideIndicators" class="slide-indicators"></div>
            </div>
        </div>

        <!-- ìƒí’ˆ ì •ë³´ -->
        <div class="glass-card rounded-2xl p-6 mb-4">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- ì¢Œì¸¡: ìƒí’ˆ ê¸°ë³¸ ì •ë³´ -->
                <div>
                    <div class="mb-4">
                        <div class="flex items-start justify-between mb-2">
                            <h2 id="productTitle" class="text-2xl font-bold text-gray-900 flex-1">ë¡œë”© ì¤‘...</h2>
                            <div id="productStatus" class="ml-3"></div>
                        </div>
                        <p id="productPrice" class="text-3xl font-bold text-green-600 mb-2">-ì›</p>
                        <div class="flex items-center gap-3 text-sm text-gray-600">
                            <span><i class="fas fa-tag mr-1"></i><span id="productCategory">-</span></span>
                            <span>â€¢</span>
                            <span><i class="fas fa-clock mr-1"></i><span id="productDate">-</span></span>
                        </div>
                    </div>

                    <div class="border-t pt-4 mb-4">
                        <h3 class="font-bold text-gray-800 mb-2">ìƒí’ˆ ì„¤ëª…</h3>
                        <p id="productDescription" class="text-gray-700 whitespace-pre-wrap leading-relaxed">
                            ë¡œë”© ì¤‘...
                        </p>
                    </div>
                </div>

                <!-- ìš°ì¸¡: íŒë§¤ì ë° í†µê³„ -->
                <div>
                    <!-- ìƒí’ˆ í†µê³„ -->
                    <div class="flex items-center gap-6 text-sm text-gray-600 mb-6">
                        <div class="flex items-center gap-1">
                            <i class="fas fa-eye"></i>
                            <span id="viewCount">0</span>
                        </div>
                        <div class="flex items-center gap-1">
                            <i class="fas fa-heart"></i>
                            <span id="likeCount">0</span>
                        </div>
                        <div class="flex items-center gap-1">
                            <i class="fas fa-comment"></i>
                            <span id="chatCount">0</span>
                        </div>
                    </div>

                    <!-- íŒë§¤ì ì •ë³´ -->
                    <div class="border-t pt-4">
                        <h3 class="font-bold text-gray-800 mb-3">íŒë§¤ì ì •ë³´</h3>
                        <div class="flex items-center gap-3">
                            <img id="sellerAvatar" src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2248%22%20height%3D%2248%22%20viewBox%3D%220%200%2048%2048%22%3E%3Ccircle%20cx%3D%2224%22%20cy%3D%2224%22%20r%3D%2224%22%20fill%3D%22%2310b981%22%2F%3E%3Ccircle%20cx%3D%2224%22%20cy%3D%2218%22%20r%3D%229%22%20fill%3D%22white%22%2F%3E%3Cellipse%20cx%3D%2224%22%20cy%3D%2242%22%20rx%3D%2214%22%20ry%3D%229%22%20fill%3D%22white%22%2F%3E%3C%2Fsvg%3E" alt="íŒë§¤ì" 
                                 class="w-12 h-12 rounded-full object-cover border-2 border-gray-200">
                            <div>
                                <p id="sellerName" class="font-bold text-gray-900">ë¡œë”©ì¤‘...</p>
                                <p class="text-sm text-gray-600">
                                    <i class="fas fa-map-marker-alt mr-1"></i>
                                    <span id="productLocation">ìœ„ì¹˜</span>
                                </p>
                                <p class="text-xs text-gray-500">
                                    ê°€ì…ì¼: <span id="sellerJoinDate">-</span>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ê±°ë˜ í¬ë§ ì¥ì†Œ (ì§€ë„) -->
        <div id="mapContainer" class="hidden glass-card rounded-2xl p-6 mb-4">
            <h3 class="font-bold text-lg text-gray-800 mb-3">
                <i class="fas fa-map-marker-alt text-green-600 mr-2"></i>ê±°ë˜ í¬ë§ ì¥ì†Œ
            </h3>
            <div id="tradeMap"></div>
        </div>

        <!-- íŒë§¤ìì˜ ë‹¤ë¥¸ ìƒí’ˆ -->
        <div class="glass-card rounded-2xl p-6 mb-4">
            <h3 class="font-bold text-lg text-gray-800 mb-4">
                <i class="fas fa-store text-purple-600 mr-2"></i>íŒë§¤ìì˜ ë‹¤ë¥¸ ìƒí’ˆ
            </h3>
            <div id="sellerOtherProducts" class="grid grid-cols-2 lg:grid-cols-4 gap-4">
                <p class="col-span-full text-center text-gray-500">ë¡œë”© ì¤‘...</p>
            </div>
        </div>

        <!-- í•¨ê»˜ ë³¸ ìƒí’ˆ (ì¶”ì²œ) -->
        <div class="glass-card rounded-2xl p-6 mb-4">
            <h3 class="font-bold text-lg text-gray-800 mb-4">
                <i class="fas fa-lightbulb text-yellow-500 mr-2"></i>ì´ëŸ° ìƒí’ˆì€ ì–´ë•Œìš”?
            </h3>
            <div id="similarProducts" class="grid grid-cols-2 lg:grid-cols-4 gap-4">
                <p class="col-span-full text-center text-gray-500">ë¡œë”© ì¤‘...</p>
            </div>
        </div>
    </div>

    <!-- í•˜ë‹¨ ê³ ì • ë°” -->
    <div class="floating-bottom">
        <div class="container mx-auto max-w-4xl">
            <!-- êµ¬ë§¤ì ì•¡ì…˜ -->
            <div id="buyerActions" class="flex items-center gap-3">
                <button id="likeBtn" onclick="toggleLike()" class="p-3 border border-gray-200 rounded-xl hover:bg-gray-50 transition">
                    <i id="likeIcon" class="far fa-heart text-gray-600 text-xl"></i>
                </button>
                <button id="actionBtn" onclick="handleChatClick()" class="flex-1 bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-xl font-bold transition">
                    ì±„íŒ…í•˜ê¸°
                </button>
            </div>
            
            <!-- íŒë§¤ì ì•¡ì…˜ (ë³¸ì¸ ìƒí’ˆì¼ ë•Œë§Œ í‘œì‹œ) -->
            <div id="ownerActions" class="hidden space-y-3">
                <div class="flex items-center gap-3">
                    <button onclick="openStatusModal()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded-xl font-medium transition">
                        <i class="fas fa-sync-alt mr-2"></i>ìƒíƒœ ë³€ê²½
                    </button>
                    <button onclick="editProduct()" class="flex-1 bg-green-600 hover:bg-green-700 text-white px-4 py-3 rounded-xl font-medium transition">
                        <i class="fas fa-edit mr-2"></i>ìˆ˜ì •
                    </button>
                    <button onclick="deleteProduct()" class="flex-1 bg-red-600 hover:bg-red-700 text-white px-4 py-3 rounded-xl font-medium transition">
                        <i class="fas fa-trash mr-2"></i>ì‚­ì œ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ìƒíƒœ ë³€ê²½ ëª¨ë‹¬ -->
    <div id="statusModal" class="modal hidden" onclick="if(event.target === this) closeStatusModal()">
        <div class="modal-content p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-gray-800">ê±°ë˜ ìƒíƒœ ë³€ê²½</h3>
                <button onclick="closeStatusModal()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="space-y-3">
                <button onclick="changeStatus('íŒë§¤ì¤‘')" class="w-full p-4 bg-blue-50 hover:bg-blue-100 rounded-xl text-left transition">
                    <span class="font-bold text-blue-600">íŒë§¤ì¤‘</span>
                    <p class="text-sm text-gray-600 mt-1">íŒë§¤ ê°€ëŠ¥í•œ ìƒíƒœë¡œ ë³€ê²½</p>
                </button>
                <button onclick="changeStatus('ì˜ˆì•½ì¤‘')" class="w-full p-4 bg-orange-50 hover:bg-orange-100 rounded-xl text-left transition">
                    <span class="font-bold text-orange-600">ì˜ˆì•½ì¤‘</span>
                    <p class="text-sm text-gray-600 mt-1">êµ¬ë§¤ìì™€ ê±°ë˜ ì˜ˆì•½ë¨</p>
                </button>
                <button onclick="changeStatus('íŒë§¤ì™„ë£Œ')" class="w-full p-4 bg-red-50 hover:bg-red-100 rounded-xl text-left transition">
                    <span class="font-bold text-red-600">íŒë§¤ì™„ë£Œ</span>
                    <p class="text-sm text-gray-600 mt-1">ê±°ë˜ê°€ ì™„ë£Œë¨</p>
                </button>
            </div>
        </div>
    </div>

    <!-- ì‹ ê³  ëª¨ë‹¬ -->
    <div id="reportModal" class="modal hidden" onclick="if(event.target === this) closeReportModal()">
        <div class="modal-content p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-gray-800">
                    <i class="fas fa-flag text-red-600 mr-2"></i>ì‹ ê³ í•˜ê¸°
                </h3>
                <button onclick="closeReportModal()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-bold text-gray-600 mb-2">ì‹ ê³  ì‚¬ìœ </label>
                    <select id="reportReason" class="w-full p-3 border border-gray-200 rounded-xl">
                        <option value="">ì„ íƒí•´ì£¼ì„¸ìš”</option>
                        <option value="ì‚¬ê¸° ì˜ì‹¬">ì‚¬ê¸° ì˜ì‹¬</option>
                        <option value="ì „ë¬¸ íŒë§¤ì—…ì">ì „ë¬¸ íŒë§¤ì—…ì</option>
                        <option value="ë¶€ì ì ˆí•œ ê²Œì‹œê¸€">ë¶€ì ì ˆí•œ ê²Œì‹œê¸€</option>
                        <option value="ê±°ë˜ ê¸ˆì§€ í’ˆëª©">ê±°ë˜ ê¸ˆì§€ í’ˆëª©</option>
                        <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-bold text-gray-600 mb-2">ìƒì„¸ ë‚´ìš©</label>
                    <textarea id="reportDetails" rows="4" placeholder="ì‹ ê³  ì‚¬ìœ ë¥¼ ìƒì„¸íˆ ì…ë ¥í•´ì£¼ì„¸ìš”" 
                              class="w-full p-3 border border-gray-200 rounded-xl resize-none"></textarea>
                </div>
                
                <div class="bg-yellow-50 border border-yellow-200 rounded-xl p-4">
                    <p class="text-sm text-yellow-800">
                        <i class="fas fa-info-circle mr-2"></i>
                        í—ˆìœ„ ì‹ ê³  ì‹œ ì„œë¹„ìŠ¤ ì´ìš©ì´ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤
                    </p>
                </div>
                
                <div class="flex gap-3">
                    <button onclick="closeReportModal()" class="flex-1 bg-gray-100 text-gray-700 py-3 rounded-xl hover:bg-gray-200 transition">
                        ì·¨ì†Œ
                    </button>
                    <button onclick="submitReport()" class="flex-1 bg-red-600 text-white py-3 rounded-xl hover:bg-red-700 transition">
                        ì‹ ê³ í•˜ê¸°
                    </button>
                </div>
                
                <button onclick="blockUser()" class="w-full mt-2 text-sm text-gray-600 hover:text-gray-800 underline">
                    ì´ ì‚¬ìš©ìì˜ ê²Œì‹œê¸€ ë³´ì§€ ì•Šê¸°
                </button>
            </div>
        </div>
    </div>

</body>
</html>
